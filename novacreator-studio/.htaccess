<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Редирект с .php на версию без расширения (301 - постоянный редирект)
    # Только для файлов в корне сайта, исключая подпапки (admin, client, includes, backend и т.д.)
    RewriteCond %{THE_REQUEST} \s/+([^/?\s]+)\.php[\s?] [NC]
    RewriteCond %{REQUEST_URI} !^/(admin|client|includes|backend|assets|telegram_bot|data|adm)/ [NC]
    RewriteRule ^ /%1? [R=301,L]
    
    # Правила для админ-панели через /adm (должны быть ПЕРЕД другими правилами)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^adm/login$ /admin/login.php [L]
    
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^adm/chats$ /admin/chats.php [L]
    
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^adm/(.*)$ /admin/$1 [L]
    
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^adm/?$ /admin/index.php [L]
    
    # Проверяем, что файл или директория не существуют
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    
    # Правила для основных страниц сайта
    RewriteRule ^services$ /services.php [L]
    RewriteRule ^seo$ /seo.php [L]
    RewriteRule ^ads$ /ads.php [L]
    RewriteRule ^about$ /about.php [L]
    RewriteRule ^contact$ /contact.php [L]
    RewriteRule ^portfolio$ /portfolio.php [L]
    RewriteRule ^vacancies$ /vacancies.php [L]
    RewriteRule ^calculator$ /calculator.php [L]
    RewriteRule ^blog$ /blog.php [L]
    RewriteRule ^faq$ /faq.php [L]
    
    # Правила для клиентской части
    RewriteRule ^client/login$ /client/login.php [L]
    RewriteRule ^client/dashboard$ /client/dashboard.php [L]
    RewriteRule ^client/logout$ /client/logout.php [L]
    
    # Правила для админ-панели (старые пути)
    RewriteRule ^admin/projects$ /admin/projects.php [L]
</IfModule>

<FilesMatch "\.(json)$">
    <IfModule mod_headers.c>
        Header set Access-Control-Allow-Origin "*"
        Header set Content-Type "application/json"
    </IfModule>
</FilesMatch>
