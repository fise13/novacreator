# Сохранение данных при обновлениях через Git

## Важно!

База данных `data/app.db` содержит все данные пользователей и **НЕ должна** попадать в Git репозиторий.

## Что уже настроено:

1. ✅ Файл `data/app.db` добавлен в `.gitignore`
2. ✅ База данных автоматически создается при первом запуске
3. ✅ Миграции выполняются автоматически при подключении к БД

## При обновлении проекта через Git:

### Безопасный процесс обновления:

```bash
# 1. Сделайте резервную копию базы данных (рекомендуется)
cp novacreator-studio/data/app.db novacreator-studio/data/app.db.backup

# 2. Обновите код через git
git pull origin main

# 3. База данных останется нетронутой, так как она в .gitignore
# 4. Новые миграции применятся автоматически при следующем запросе
```

## Что происходит при обновлении:

- ✅ **Код обновляется** - новые файлы PHP, CSS, JS и т.д.
- ✅ **База данных сохраняется** - все пользователи, проекты и данные остаются
- ✅ **Миграции применяются автоматически** - новые поля добавляются в существующие таблицы
- ✅ **Данные не теряются** - все записи остаются на месте

## Резервное копирование (рекомендуется):

Перед каждым обновлением рекомендуется делать резервную копию:

```bash
# 1. Создать резервную копию базы данных
cp novacreator-studio/data/app.db novacreator-studio/data/app.db.backup.$(date +%Y%m%d_%H%M%S)

# 2. Создать резервную копию OAuth конфигурации (ВАЖНО!)
cd novacreator-studio
php scripts/export_oauth_config.php > data/backups/oauth_config_backup.json

# Или использовать автоматический скрипт
chmod +x scripts/backup_oauth.sh
./scripts/backup_oauth.sh
```

### Восстановление OAuth конфигурации:

Если после обновления OAuth перестал работать:

```bash
# Восстановить OAuth конфигурацию из резервной копии
php scripts/import_oauth_config.php data/backups/oauth_config_backup.json
```

## Восстановление из резервной копии:

Если что-то пошло не так:

```bash
# Остановите веб-сервер
# Восстановите базу данных
cp novacreator-studio/data/app.db.backup novacreator-studio/data/app.db
# Запустите веб-сервер снова
```

## Проверка .gitignore:

Убедитесь, что в `.gitignore` есть:

```
novacreator-studio/data/app.db
novacreator-studio/data/*.db
novacreator-studio/data/*.db-journal
```

## Важно помнить:

- ❌ **НЕ коммитьте** `data/app.db` в Git
- ❌ **НЕ удаляйте** `data/app.db` при обновлении
- ✅ **Делайте резервные копии** перед обновлениями (БД + OAuth конфигурация)
- ✅ **Проверяйте** `.gitignore` перед коммитами
- ⚠️ **OAuth конфигурация** хранится в БД - делайте бэкап перед обновлениями!

## OAuth конфигурация:

OAuth конфигурация (Google, Apple) хранится в таблице `oauth_config` базы данных. 

**Проблема:** При обновлении через Git база данных сохраняется, но если она была пересоздана или удалена, данные OAuth могут потеряться.

**Решение:** Используйте скрипты экспорта/импорта:

```bash
# Экспорт
php scripts/export_oauth_config.php > oauth_config_backup.json

# Импорт
php scripts/import_oauth_config.php oauth_config_backup.json
```

