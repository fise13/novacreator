function initLazyLoading(){const t=document.querySelectorAll('img[loading="lazy"]');if("IntersectionObserver"in window){const e=new IntersectionObserver(function(t,e){t.forEach(t=>{if(t.isIntersecting){const n=t.target;n.dataset.src&&(n.src=n.dataset.src,delete n.dataset.src),n.classList.add("loaded"),e.unobserve(n)}})},{rootMargin:"50px"});t.forEach(t=>{e.observe(t)})}else t.forEach(t=>{t.dataset.src&&(t.src=t.dataset.src),t.classList.add("loaded")})}function initAnimations(){const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches,e=window.innerWidth<768,n=new IntersectionObserver(function(t){t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("animate-fade-in"),t.target.style.opacity="1",t.target.style.transform="translateY(0)",n.unobserve(t.target))})},{threshold:e?.05:.1,rootMargin:e?"0px 0px -30px 0px":"0px 0px -50px 0px"});document.querySelectorAll(".animate-on-scroll").forEach(o=>{if(t)return o.style.opacity="1",void(o.style.transform="translateY(0)");o.style.opacity="0",o.style.transform="translateY(30px)";const i=e?"0.4s":"0.6s";o.style.transition=`opacity ${i} ease-out, transform ${i} ease-out`,n.observe(o)})}function initNavigation(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(t){const e=this.getAttribute("href");if("#"===e)return;t.preventDefault();const n=document.querySelector(e);n&&n.scrollIntoView({behavior:"smooth",block:"start"})})});const t=document.querySelector(".navbar");if(t){let n=window.scrollY,o=!1;function e(){const e=window.scrollY,i=window.innerWidth<768;e>50?(t.classList.add("scrolled"),t.style.height=i&&e>n&&e>100?"3.5rem":""):(t.classList.remove("scrolled"),t.style.height=""),n=e,o=!1}window.addEventListener("scroll",function(){o||(window.requestAnimationFrame(e),o=!0)},{passive:!0})}}function initForms(){document.querySelectorAll(".contact-form").forEach(t=>{t.addEventListener("submit",async function(e){e.preventDefault();const n=t.querySelector('input[type="email"]'),o=t.querySelector('input[type="tel"]'),i=t.querySelector('input[name="name"]'),s=t.querySelector('textarea[name="message"]');function r(t,e){t.classList.add("border-red-500");const n=document.createElement("div");n.className="error-message text-red-400 text-sm mt-1",n.textContent=e,t.parentNode.appendChild(n)}t.querySelectorAll(".border-red-500").forEach(t=>{t.classList.remove("border-red-500")}),t.querySelectorAll(".error-message").forEach(t=>{t.remove()});let a=!0;if(i&&i.hasAttribute("required")){const t=i.value.trim();(!t||t.length<2)&&(a=!1,r(i,"Имя должно содержать минимум 2 символа"))}if(n&&n.hasAttribute("required")){const t=n.value.trim();t?function(t){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t)}(t)||(a=!1,r(n,"Введите корректный email адрес")):(a=!1,r(n,"Email обязателен для заполнения"))}if(o&&o.hasAttribute("required")){const t=o.value.trim();t?function(t){const e=t.replace(/[\s\-\(\)]/g,"");return/^(\+?7|8)?[0-9]{10}$/.test(e)&&e.length>=10}(t)||(a=!1,r(o,"Введите корректный номер телефона (например: +7 700 123 45 67)")):(a=!1,r(o,"Телефон обязателен для заполнения"))}if(s&&s.hasAttribute("required")){const t=s.value.trim();(!t||t.length<10)&&(a=!1,r(s,"Сообщение должно содержать минимум 10 символов"))}if(!a){showNotification("Пожалуйста, исправьте ошибки в форме перед отправкой.","error");const e=t.querySelector(".border-red-500");return void(e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus()))}const c=t.querySelector('button[type="submit"]'),l=c.innerHTML,d=c.disabled;c.disabled=!0,c.style.opacity="0.7",c.style.cursor="not-allowed",c.innerHTML='<span class="flex items-center justify-center"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Отправка...</span>';const u=new FormData(t);try{let n=t.getAttribute("action");if(n||(n="/backend/send.php"),!n.startsWith("/")&&!n.startsWith("http"))try{const t=new URL(window.location.href),e=new URL(n,t);n=e.pathname+e.search}catch(e){n="/"+n}const o=await fetch(n,{method:"POST",body:u});if(!o.ok){if(404===o.status)return showNotification("Ошибка: файл обработчика формы не найден. Пожалуйста, свяжитесь с администратором сайта.","error"),void console.error("404 Error: Form handler not found at:",n);try{showNotification((await o.json()).message||"Произошла ошибка при отправке. Попробуйте позже.","error")}catch(e){showNotification("Ошибка сервера (код "+o.status+"). Попробуйте позже или свяжитесь с нами напрямую.","error")}return}let i;try{i=await o.json()}catch(e){return console.error("Ошибка парсинга JSON:",e),void showNotification("Ошибка обработки ответа сервера. Попробуйте позже.","error")}i.success?(showNotification("Спасибо! Ваша заявка отправлена. Мы свяжемся с вами в ближайшее время.","success"),t.reset()):showNotification(i.message||"Произошла ошибка при отправке. Попробуйте позже.","error")}catch(t){console.error("Ошибка отправки формы:",t),showNotification("Ошибка соединения. Проверьте интернет и попробуйте снова.","error")}finally{c.disabled=d,c.style.opacity="1",c.style.cursor="",c.innerHTML=l}})})}function showNotification(t,e="success"){const n=window.innerWidth<768?"top-4 left-4 right-4":"top-4 right-4",o=document.createElement("div");o.className=`fixed ${n} z-50 px-4 py-3 md:px-6 md:py-4 rounded-lg shadow-lg transform transition-all duration-300 text-sm md:text-base ${"success"===e?"bg-green-600 text-white":"bg-red-600 text-white"}`,o.textContent=t,document.body.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateX(0)"},10),setTimeout(()=>{o.style.opacity="0",o.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(o)},300)},5e3)}function initScrollEffects(){const t=window.innerWidth<768,e=window.matchMedia("(prefers-reduced-motion: reduce)").matches,n=document.querySelectorAll(".parallax");if(!t&&!e&&n.length>0){let t=!1;window.addEventListener("scroll",function(){t||(window.requestAnimationFrame(function(){const e=window.pageYOffset;n.forEach(t=>{const n=t.dataset.speed||.5,o=-e*n;t.style.transform=`translateY(${o}px)`}),t=!1}),t=!0)},{passive:!0})}const o=document.querySelectorAll("section[id]"),i=document.querySelectorAll(".nav-link");window.addEventListener("scroll",function(){let t="";o.forEach(e=>{const n=e.offsetTop;e.clientHeight;window.pageYOffset>=n-200&&(t=e.getAttribute("id"))}),i.forEach(e=>{e.classList.remove("active"),e.getAttribute("href")===`#${t}`&&e.classList.add("active")})})}function animateCounter(t,e,n="",o="",i=2e3){let s=0;const r=e/(i/16),a=setInterval(()=>{s+=r,s>=e?(t.textContent=n+e+o,clearInterval(a)):t.textContent=n+Math.floor(s)+o},16)}function initCounters(){const t=document.querySelectorAll(".counter-number");if(0===t.length)return;t.forEach(t=>{const e=parseInt(t.getAttribute("data-target"))||0,n=t.getAttribute("data-prefix")||"",o=t.getAttribute("data-suffix")||"";t.textContent=n+e+o});const e=new IntersectionObserver(function(t){t.forEach(t=>{if(t.isIntersecting){const n=t.target,o=parseInt(n.getAttribute("data-target"))||0,i=n.getAttribute("data-prefix")||"",s=n.getAttribute("data-suffix")||"",r=parseInt(n.getAttribute("data-duration"))||2e3;n.classList.contains("counter-animated")||(n.classList.add("counter-animated"),n.textContent=i+"0"+s,setTimeout(()=>{animateCounter(n,o,i,s,r)},100)),e.unobserve(n)}})},{threshold:.2,rootMargin:"0px 0px -100px 0px"});t.forEach(t=>{e.observe(t)})}function initProgressBars(){const t=document.querySelectorAll(".progress-bar");if(0===t.length)return;const e=new IntersectionObserver(function(t){t.forEach(t=>{if(t.isIntersecting){const n=t.target,o=parseInt(n.getAttribute("data-width"))||0;n.classList.contains("progress-animated")||(n.classList.add("progress-animated"),n.style.width="0%",setTimeout(()=>{let t=0;const e=o/125,i=setInterval(()=>{t+=e,t>=o?(n.style.width=o+"%",clearInterval(i)):n.style.width=Math.floor(t)+"%"},16)},200)),e.unobserve(n)}})},{threshold:.2,rootMargin:"0px 0px -50px 0px"});t.forEach(t=>{e.observe(t)})}function initScrollProgress(){const t=document.querySelector(".scroll-progress-bar");t&&window.addEventListener("scroll",function(){const e=document.documentElement.scrollHeight-document.documentElement.clientHeight,n=window.pageYOffset/e*100;t.style.width=n+"%"})}function initBackToTop(){const t=document.getElementById("backToTop");if(!t)return;let e=0,n=!1;window.addEventListener("scroll",function(){n||(window.requestAnimationFrame(function(){const o=window.pageYOffset||document.documentElement.scrollTop,i=o/(document.documentElement.scrollHeight-window.innerHeight)*100;if(o>300){t.classList.remove("opacity-0","pointer-events-none"),t.classList.add("opacity-100");const e=document.getElementById("scrollProgressCircle");if(e){const t=2*Math.PI*45,n=t-i/100*t;e.style.strokeDashoffset=n,e.style.opacity=i>10?"0.6":"0.3"}}else t.classList.add("opacity-0","pointer-events-none"),t.classList.remove("opacity-100");t.style.transform=o>e&&o>300?"translateY(5px)":"translateY(0)",e=o,n=!1}),n=!0)},{passive:!0}),t.addEventListener("click",function(){this.style.transform="scale(0.9)",setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.style.transform=""},100)},50)}),t.addEventListener("mouseenter",function(){this.style.transform="scale(1.15) translateY(-3px)"}),t.addEventListener("mouseleave",function(){window.pageYOffset>300&&(this.style.transform="")})}function initPageLoadAnimation(){document.body.classList.add("page-loaded");document.querySelectorAll("section, header, footer").forEach((t,e)=>{t.style.opacity="0",t.style.transform="translateY(30px) scale(0.98)",t.style.transition="opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1)",t.style.willChange="opacity, transform",setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0) scale(1)",setTimeout(()=>{t.style.willChange="auto"},800)},80*e)});document.querySelectorAll(".service-card").forEach((t,e)=>{t.style.opacity="0",t.style.transform="translateY(40px) rotateX(10deg)",t.style.transition="opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)",setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0) rotateX(0deg)"},400+100*e)})}function initTouchOptimizations(){if(!("ontouchstart"in window||navigator.maxTouchPoints>0))return;document.querySelectorAll("button, a, .btn-neon, .btn-outline, .service-card, input, textarea, select").forEach(t=>{t.addEventListener("touchstart",function(){this.style.opacity="0.8",function(t="light"){if("vibrate"in navigator){const e={light:10,medium:20,heavy:30};navigator.vibrate(e[t]||e.light)}}("light")},{passive:!0}),t.addEventListener("touchend",function(){setTimeout(()=>{this.style.opacity="1"},100)},{passive:!0});let e=0;t.addEventListener("touchend",function(t){const n=Date.now();n-e<=300&&t.preventDefault(),e=n},{passive:!1})});let t=0,e=0,n=0,o=0;document.addEventListener("touchstart",function(n){t=n.changedTouches[0].screenX,e=n.changedTouches[0].screenY},{passive:!0}),document.addEventListener("touchend",function(i){n=i.changedTouches[0].screenX,o=i.changedTouches[0].screenY,function(){const i=n-t,s=o-e,r=50;Math.abs(i)>Math.abs(s)&&Math.abs(i);if(s<-r&&window.pageYOffset>500){const t=document.getElementById("backToTop");t&&(t.classList.remove("opacity-0","pointer-events-none"),t.classList.add("opacity-100"))}}()},{passive:!0});let i=!1;window.addEventListener("touchstart",function(){i=!0},{passive:!0}),window.addEventListener("touchend",function(){i=!1},{passive:!0});let s=!1;window.addEventListener("scroll",function(){s||(window.requestAnimationFrame(function(){s=!1}),s=!0)},{passive:!0}),document.documentElement.classList.add("touch-device")}document.addEventListener("DOMContentLoaded",function(){initAnimations(),initNavigation(),initForms(),initScrollEffects(),initCounters(),initProgressBars(),initScrollProgress(),initBackToTop(),initPageLoadAnimation(),initTouchOptimizations(),initLazyLoading()}),window.NovaCreator={animateCounter:animateCounter,showNotification:showNotification,initCounters:initCounters,initProgressBars:initProgressBars,initScrollProgress:initScrollProgress,initBackToTop:initBackToTop,initTouchOptimizations:initTouchOptimizations};